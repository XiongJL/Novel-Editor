# Tasks

- [ ] 灵感搜索与过滤功能 (Idea Search & Filtering)
    - [x] **Phase 1: 统一搜索工作台基础框架**
        - [x] 创建侧边栏/弹窗容器组件 (`UnifiedSearchWorkbench`)
        - [x] 实现一级过滤器 (搜索范围: 全部/灵感/章节/小说)
        - [x] 实现内容类型过滤器 (已整合进搜索范围)
        - [x] 实现防抖关键词搜索框
        - [x] 确保核心数据结构支持字段检索
    - [x] **Phase 2: 灵感工作台深度功能**
        - [x] 实现二级过滤器 (小说/卷/章节联动) - *已精简为灵感专用过滤器*
        - [x] 标签筛选与管理 - *已实现带搜索功能的自定义下拉菜单*
        - [x] 时间范围与收藏筛选 - *已实现*
        - [x] 灵感结果卡片 UI (带原文引用)
        - [x] **Phase 2.5: 功能整合 (IdeaList -> UnifiedSearchWorkbench)**
            - [x] 增强 `SearchResultsList`: 添加星标(Star)与删除(Delete)按钮
            - [x] 增强 `UnifiedSearchWorkbench`: 添加新建灵感(+)入口
            - [x] 重构 `Editor.tsx`: 替换灵感Tab为增强版搜索工作台
            - [x] **侧边栏分离 (Separation)**
                - [x] 创建 `SearchSidebar`: 独立的搜索侧边栏组件
                - [x] 简化 `UnifiedSearchWorkbench`: 仅保留灵感搜索，移除Scope切换
                - [x] 简化 `IdeaAdvancedFilter`: 移除小说/章节下拉过滤
            - [x] 废弃并移除 `IdeaList.tsx`
            - [x] **反向导航反馈 (Reverse Feedback)**
                - [x] 在 `Editor.tsx` 增加高亮状态逻辑
                - [x] 在 `SearchResultsList` 实现自动滚动与闪烁动画
            - [x] **灵感卡片收藏 UI 增强 (Starred UI Refinement)**
                - [x] 迭代收藏样式：移除边框变色，采用更优雅的角标 Banner 设计
            - [x] **编辑器暗色模式适配 (Dark Mode Fix)**
                - [x] 修复编辑器高亮文字在暗色模式下显示为黑色的问题
            - [x] **设置区域国际化 (Settings i18n)**
                - [x] 为设置面板的“通用”和“快捷键”区域添加完整的多语言支持
                - [x] 修复漏掉的快捷键翻译 ("Enter Focus", "Create Idea")
            - [x] **设置区域主题适配 (Settings Theme Fix)**
                - [x] 修复设置面板在浅色模式下样式不生效的问题，实现完整的视觉适配
            - [x] **主页列表主题适配 (Home Theme Fix)**
                - [x] 适配 `Home.tsx` 及其子组件 `ProjectCard` 在浅色模式下的样式
    - [x] **Git 初始化与备份 (Git Init)**
        - [x] 初始化 Git 仓库并推送到远程 GitHub
        - [x] 配置完善的 `.gitignore` 规则（排除日志、构建产物、依赖等）
    - [x] **Phase 3: 全局搜索集成**
        - [x] 接入小说与章节内容索引 (FTS5 全文索引)
        - [x] 搜索结果分组展示 (章节/灵感)
        - [x] 实现点击跳转 + 关键词高亮
- [x] **数据备份与恢复 (Backup & Restore System)**
    - [x] 数据导出 (Export): 格式为 `.nebak` (ZIP + JSON + Manifest)
    - [x] 数据加密 (Encryption): AES-256-GCM + PBKDF2
    - [x] 自动备份 (Auto Backup): 恢复前自动快照，自动轮替保留最新3份
    - [x] 数据恢复 (Restore): 事务性恢复 (Atomicity)，清空旧数据后写入新数据
    - [x] 备份设置面板 (Settings UI): 集成于设置模态框，支持密码保护
- [x] **架构重构与稳定性修复 (Architecture Refactoring & Stability)**
    - [x] **Editor.tsx 重构**: 修复重复组件定义，合并状态管理，恢复丢失的 UI 逻辑
    - [x] **Story Structure Backend**: 修复 `PlotLine` Prisma Client 同步问题，增强 IPC 错误处理
- [x] **剧情大纲交互增强 (Story Structure Enhancements)**
    - [x] **Phase 4: 基础交互与排序 (Interactions & Sorting)**
        - [x] 安装 `@dnd-kit`
        - [x] 后端实现 `reorderPlotLines/Points`
        - [x] 前端实现拖拽排序 UI
        - [x] 优化“要点创建”为快速输入模式
    - [x] **Phase 5: 深度编辑与矩阵视图 (Matrix & Details)**
        - [x] 实现 `PlotPointModal` (编辑标题、描述、类型、状态)
        - [x] 实现 `NarrativeMatrix` (表格视图、筛选器)
    - [x] **Phase 6: 锚点与编辑器集成 (Anchors & Editor)**
        - [x] 实现 `AnchorPlugin` (Lexical 高亮)
        - [x] 实现右键菜单 "Add to Plot"
        - [x] 实现锚点跳转与数据联动
            - [x] **Phase 6.5: 锚点跳转优化 (Anchor Jump Improvement)**
                - [x] 实现 `handleJumpToPlotPoint` (bi-directional sync)
                - [x] 更新 `PlotSidebar` / `PlotPointItem` 添加跳转按钮
                - [x] 实现无锚点时的抖动反馈 (Shake Animation)

    - [x] **Phase 8: 角色系统增强 (Character System)**
        - [x] **@Mentions**: 在剧情要点与矩阵视图中实现快捷选取与高亮
        - [x] **角色卡片**: 实现点击 Mention 弹出详情档案卡
        - [x] **交互优化**: 采用全透明 Textarea 方案解决文本重叠，实现 Click-outside 自动关闭
    - [x] **Phase 9: UI 样式大统一与交互安全 (UI Unification)**
        - [x] **按钮迁移**: 统一将删除按钮移至模态框页脚左侧
        - [x] **确认拦截**: 全系统集成 `ConfirmModal` 二次确认机制
        - [x] **视觉对齐**: 统一页脚按钮比例与 `text-xs` 字号
        - [x] 完善角色、物品功能
- [ ] 云同步功能开发
    - [ ] `SyncService.java` 代码审查
    - [ ] 增量同步逻辑完善
